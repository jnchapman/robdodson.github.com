
<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta charset="utf-8">
	<title>Backbone Events: Framework Communication | Rob Dodson talks internets</title>

	<meta name="author" content="Rob Dodson">
	
	<meta name="description" content="Hi I'm Rob Dodson. A freelance developer specializing in JavaScript and Backbone.js with a touch of Node and Ruby.">

	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link href="/atom.xml" rel="alternate" title="Rob Dodson talks internets" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400" />
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>

<body class="post-template">
  <main class="content" role="main"><article class="post">
  
	<header class="post-header">
		<a id="blog-logo" href="/">Rob Dodson talks internets</a>
	</header>
	<span class="post-meta">25 May 2012</span>
	<h1 class="post-title">Backbone Events: Framework Communication</h1>
	<section class="post-content">
		<p>I want to figure out how to communicate on a framework level within Backbone. Coming from Flash and <a href="http://www.robotlegs.org/">RobotLegs</a> I&#8217;m used to a few MVC conventions that work very well as far as event dispatching goes. In RobotLegs you typically have a framework wide eventDispatcher that anyone can tune into. In a nutshell your View will trigger an event, for instance a user clicking a button, and that will get dispatched to interested framework actors. These can be other Views or, more likely, they can be Commands. The Commands are like single use actions tied directly to events. Think of it like binding every public method of your controller to an event. The Commands will typically effect models, changing them in some way, and the Models will dispatch an event that the Views listen for to update themselves.</p>

<p>Backbone works differently in that Views are often tied directly to their models like so:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Documents</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span> <span class="c1">// &lt;-- Model object</span>

<span class="k">new</span> <span class="nx">DocumentRow</span><span class="p">({</span> <span class="c1">// &lt;-- View object with model reference</span>
  <span class="nx">model</span><span class="o">:</span> <span class="nx">doc</span><span class="p">,</span>
  <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;document-row-&quot;</span> <span class="o">+</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">id</span>
<span class="p">});</span>
</code></pre></figure>


<p>When you use this approach it&#8217;s trivial to tell the view to listen to the model&#8217;s change event and then call <code>view.render()</code>. Essentially you are munging some of a Controller&#8217;s responsibilities into the View. That&#8217;s all well and good but let&#8217;s say we want to dispatch an event from one view which will affect other views and actors. This event has nothing to do with a model, maybe it&#8217;s just an animation of some kind that others need to know about. So how do we go about this?</p>

<!--more-->


<h3>Communicating between Views in Backbone</h3>

<p>To facilitate this communication we&#8217;re going to use the <code>app</code> object that <a href="https://github.com/tbranyen/backbone-boilerplate">Backbone Boilerplate</a> creates for us. If you look in the <code>namespace.js</code> file that comes with the boilerplate you should see a line like this way down at the bottom:</p>

<figure class='code'><figcaption><span>namespace.js</span></figcaption><pre><code><span class="nx">app</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">)</span>
</code></pre></figure>


<p>If you&#8217;re not familiar with <a href="http://underscorejs.org/#extend">Underscore.js&#8217;s extend method</a> it basically takes all of the properties and functions of one object and copies them onto another. If you&#8217;re coming from a language that supports classical inheritence this should feel familiar. In the above example it&#8217;s creating a new empty object (app), and extending/inheriting from the Backbone.Events object. This means that the <code>app</code> property of the <code>namespace</code> module is basically one big event dispatcher.</p>

<p>So let&#8217;s create two very simple views in a module called <code>Chatty</code>. One will be <code>Subject</code> and the other <code>Observer</code>. When we click the Subject we want it to dispatch an event that any framework actor can tune into. We&#8217;ll call this event <code>clicked:subject</code>. When the Observer hears the <code>clicked:subject</code> event we want it to replace its html content with whatever message is sent along.</p>

<figure class='code'><figcaption><span>chatty.js</span></figcaption><pre><code><span class="nx">define</span><span class="p">([</span>
  <span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="c1">// &lt;-- see I&#39;m bringing in the namespace module</span>

  <span class="c1">// Libs</span>
  <span class="s2">&quot;use!backbone&quot;</span>

  <span class="c1">// Modules</span>

  <span class="c1">// Plugins</span>

<span class="p">],</span>

<span class="kd">function</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// &lt;-- make sure to pass namespace as an argument</span>

  <span class="c1">// Create a new module</span>
  <span class="kd">var</span> <span class="nx">Chatty</span> <span class="o">=</span> <span class="nx">namespace</span><span class="p">.</span><span class="nx">module</span><span class="p">();</span>

  <span class="nx">Chatty</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Subject</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">tagName</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;subject&#39;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="s1">&#39;onClick&#39;</span>
    <span class="p">},</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;I&#39;m the Subject. Everyone listen up!&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">onClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">namespace</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;clicked:subject&#39;</span><span class="p">,</span> <span class="s1">&#39;watch it, buster!&#39;</span><span class="p">);</span> <span class="c1">// &lt;-- trigger a framework event</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Chatty</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Observer</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">tagName</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;observer&#39;</span><span class="p">,</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;I&#39;m the Observer. Quietly waiting...&quot;</span><span class="p">);</span>

      <span class="nx">namespace</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;clicked:subject&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSubjectClicked</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span> <span class="o">&lt;--</span> <span class="nx">listen</span> <span class="k">for</span> <span class="nx">framework</span> <span class="nx">events</span>
    <span class="p">},</span>
    <span class="nx">onSubjectClicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;I heard the Subject say... &quot;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Required, return the module for AMD compliance</span>
  <span class="k">return</span> <span class="nx">Chatty</span><span class="p">;</span>

<span class="p">});</span>
</code></pre></figure>


<p>In our main.js file we&#8217;re just going to append those two views to the DOM whenever someone hits our route:</p>

<figure class='code'><figcaption><span>main.js</span></figcaption><pre><code><span class="nx">require</span><span class="p">([</span>
  <span class="s2">&quot;namespace&quot;</span><span class="p">,</span>

  <span class="c1">// Libs</span>
  <span class="s2">&quot;jquery&quot;</span><span class="p">,</span>
  <span class="s2">&quot;use!backbone&quot;</span><span class="p">,</span>

  <span class="c1">// Modules</span>
  <span class="s2">&quot;modules/chatty&quot;</span>
<span class="p">],</span>

<span class="kd">function</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">,</span> <span class="nx">Chatty</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// Defining the application router, you can attach sub routers here.</span>
  <span class="kd">var</span> <span class="nx">Router</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;chatty&quot;</span><span class="o">:</span> <span class="s2">&quot;chatty&quot;</span>
    <span class="p">},</span>

    <span class="nx">chatty</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Chatty</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Subject</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Chatty</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Observer</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#main&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#main&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">observer</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="p">...</span>
</code></pre></figure>


<p>And there you have it. When we click on <code>Subject</code> it should replace the content in <code>Observer</code> like so:
<img class="center" src="/images/subject_observer.png" title="'The Observer hears the Subject'" ></p>

<p>You should follow me on Twitter <a href="http://twitter.com/rob_dodson">here.</a></p>

<ul class="personal-stats">
    <li>Mood: Excited, Rested</li>
    <li>Sleep: 6</li>
    <li>Hunger: 4</li>
    <li>Coffee: 0</li>
</ul>


	</section>


  <footer class="post-footer">
  <section class="author">
    <h4>Rob Dodson</h4>
    <p></p>
  </section>
  <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?text=Backbone Events: Framework Communication&amp;url=http://robdodson.me/blog/2012/05/25/backbone-events-framework-communication/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://robdodson.me/blog/2012/05/25/backbone-events-framework-communication/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://robdodson.me/blog/2012/05/25/backbone-events-framework-communication/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
    </a>
  </section>
</footer>
  <hr>
  
    <div class="share">
</div>

  
  
  <section id="comment">
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>
  
</article></main>
  <footer class="site-footer"><a class="subscribe icon-feed" href="http://robdodson.me/atom.xml"><span class="tooltip">Subscribe!</span></a>
<div class="inner">
  Follow me on <a href="http://twitter.com/rob_dodson" rel="me">Twitter</a>, <a rel="author" href="https://plus.google.com/118271135596408598424">Google+</a> or <a rel="me" href="http://github.com/robdodson">Github</a>
  <section class="copyright">All content copyright <a href="/">Rob Dodson</a> © 2013 • All rights reserved.</section>
  <section class="poweredby">Casper theme by <a class="icon-ghost" href="http://tryghost.org">Ghost</a> &amp; Published with <a href="http://octopress.org">Octopress</a></section>
</div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="//yandex.st/highlightjs/7.3/highlight.min.js"></script>  
<script>hljs.initHighlightingOnLoad()</script>


<script type="text/javascript">
      var disqus_shortname = 'robdodsontalksinternets';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://robdodson.me/blog/2012/05/25/backbone-events-framework-communication/';
        var disqus_url = 'http://robdodson.me/blog/2012/05/25/backbone-events-framework-communication/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-25869920-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</body>
</html>
