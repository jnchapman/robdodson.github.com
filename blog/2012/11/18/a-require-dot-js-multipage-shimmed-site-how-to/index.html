
<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta charset="utf-8">
	<title>A Require.js multi-page shimmed site: How-To | Rob Dodson talks internets</title>

	<meta name="author" content="Rob Dodson">
	
	<meta name="description" content="Hi I'm Rob Dodson. A freelance developer specializing in JavaScript and Backbone.js with a touch of Node and Ruby.">

	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link href="/atom.xml" rel="alternate" title="Rob Dodson talks internets" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400" />
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>

<body class="post-template">
  <main class="content" role="main"><article class="post">
  
	<header class="post-header">
		<a id="blog-logo" href="/">Rob Dodson talks internets</a>
	</header>
	<span class="post-meta">18 Nov 2012</span>
	<h1 class="post-title">A Require.js Multi-page Shimmed Site: How-To</h1>
	<div class="newsletter">
  <form action="http://robdodson.us7.list-manage2.com/subscribe/post?u=5727aa0eb1ccbf4ae68284189&amp;id=6719a28b56" method="post" target="_blank" novalidate>
    <p class="newsletter-heading newsletter-primary">Get your learn on.</p>
    <p class="newsletter-heading newsletter-sub">
      Weekly emails cover Web Components, and the future of
      Front-end Development.
    </p>
    <input class="newsletter-email" type="email" value="" name="EMAIL" placeholder="your@email.com">
    <input type="hidden" name="group[4133][1]" value="true">
    <input class="newsletter-submit" type="submit" value="Subscribe" name="subscribe">
  </form>
</div>
	<section class="post-content">
		<p>I&#8217;ve been working with RequireJS a lot lately and found it really improves the way I manage my code. I had previous experience with Require in the context of some of my Backbone posts, but I&#8217;d never used it on a more traditional multi-page site before. The process of setting up Require on a multi-page site can be pretty confusing, so I thought I would put together this tutorial to help out others who might be stuck.</p>

<!--more-->


<h2>Overview</h2>

<p><em>Note: This tutorial assumes you&#8217;re already familiar with RequireJS and its configuration options. If not, I recommend you <a href="http://requirejs.org/">check out the docs</a> before proceeding</em></p>

<h2><a href="https://github.com/robdodson/requirejs-multipage-shim-boilerplate">Grab the Boilerplate</a></h2>

<p>When building single-page apps, many people choose to compile all of their JavaScript into one file before deploying to production. While this may make the initial download size of the page larger, the hope is that it reduces section-to-section http requests, thus making the overall experience feel snappier and more app-like.</p>

<p>When working with a <em>multi-page site</em>, compiling everything into one file is probably not a good idea. Since you have no guarantee that the user will visit every page, you may be loading unnecessary JavaScript and slowing down the experience. Do you really need to load all of the JavaScript for the <strong>About</strong> page if the user is just visiting the <strong>Contact</strong> page?</p>

<p>The ideal scenario is one in which each page has its own <code>main</code> file that contains page-specific instructions and then a separate (hopefully cached) file that contains all of the commonly used JavaScript libraries.</p>

<p>For example, if you have a page called <strong>About</strong> and a page called <strong>Contact</strong> you would have <code>main-about.js</code> and <code>main-contact.js</code>. Let&#8217;s say <code>main-about.js</code> and <code>main-contact.js</code> both require <code>'jquery'</code> and <code>'underscore'</code>. We wouldn&#8217;t want to compile <code>jquery</code> and <code>underscore</code> into each <code>main</code> file because then we&#8217;re creating unnecessary bloat. Instead, we should create a <code>common.js</code> file which contains <code>jquery</code> and <code>underscore</code> and we&#8217;ll make sure that this file loads before any of our <code>main-*</code> files. Take a look at this diagram to help it sink in:</p>

<p><strong>OPTIMIZED SCRIPTS</strong></p>

<figure class='code'><pre><code>common.js
----------------
js/vendor/jquery.js
js/vendor/underscore.js

About
----------------
js/common.js
js/app/main-about.js

Contact
----------------
js/common.js
js/app/main-contact.js</code></pre></figure>


<p>By compiling all of those libaries into <code>common.js</code> we&#8217;re reducing the number of http requests per page. Also, after the first page has loaded, <code>common.js</code> should be available from the browser&#8217;s cache. Now that you get the general concept, let&#8217;s take a look at an example.</p>

<h2>Examples!</h2>

<p><a href="https://twitter.com/jrburke">James Burke</a>, author of RequireJS, has done a great job putting together some example projects which show how to effectively structure your project so it can be run through the <a href="http://requirejs.org/docs/optimization.html">r.js optimization tool</a>. The one I typically refer to is the <a href="https://github.com/requirejs/example-multipage-shim">example-multipage-shim.</a> There&#8217;s also an <a href="https://github.com/requirejs/example-multipage">example-multipage</a>, but I tend to use the shim version because it seems like there&#8217;s always a few non-AMD scripts that end up in a project.</p>

<p>I&#8217;ve put together my own boilerplate, using Bootstrap 3 and GruntJS, which you guys are free to grab <a href="https://github.com/robdodson/requirejs-multipage-shim-tutorial">here.</a> The rest of this post will walk through this boilerplate.</p>

<h2>Learn you a boilerplate!</h2>

<p>If you&#8217;ve worked with RequireJS on a single page site, you&#8217;re probably used to defining a script tag that looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code><span class="c">&lt;!--This sets the baseUrl to the &quot;scripts&quot; directory, and</span>
<span class="c">    loads a script that will have a module ID of &#39;main&#39;--&gt;</span>
<span class="nt">&lt;script </span><span class="na">data-main=</span><span class="s">&quot;scripts/main.js&quot;</span> <span class="na">src=</span><span class="s">&quot;scripts/require.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></figure>


<p>The <code>data-main</code> attribute is a convenience feature of RequireJS which sets Require&#8217;s <a href="http://requirejs.org/docs/api.html#config-baseUrl">baseUrl property.</a> You usually put some configuration options in the <code>main</code> file as well, for instance, if you&#8217;re loading a 3rd party library you might create a <a href="http://requirejs.org/docs/api.html#config-paths">path</a> so you can easily reference it. Since our boilerplate has different <code>main-*</code> files for each page, we&#8217;re going to put that configuration data into our <code>common.js</code> file instead.</p>

<p><em>Hold on, I thought you said common.js was where we were going to compile all of our libraries?</em></p>

<p>Indeed, you are correct astute reader. But since <code>common.js</code> is going to be loaded before any other required modules, why not put our configuration options in it as well? Here&#8217;s what the <code>common.js</code> file from our boilerplate looks like:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code><span class="c1">//The build will inline common dependencies into this file.</span>

<span class="nx">requirejs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
  <span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;./js&#39;</span><span class="p">,</span>
  <span class="nx">paths</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;jquery&#39;</span><span class="o">:</span> <span class="s1">&#39;vendor/jquery&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bootstrap&#39;</span><span class="o">:</span> <span class="s1">&#39;vendor/bootstrap&#39;</span>
  <span class="p">},</span>
  <span class="nx">shim</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;bootstrap&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></figure>


<p>You&#8217;ll note that we&#8217;re using <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>, which is not AMD compliant out of the box, so we have to <code>shim</code> it. In this case it depends on <code>jquery</code>, so we list that as its only dependency and we&#8217;re good.</p>

<p>Aside from <code>common.js</code>, you should probably take a look in the <code>app/models</code> directory. I&#8217;ve created two models that extend a <code>BasicModel</code> in order to illustrate that the <code>common.js</code> file isn&#8217;t only for 3rd party code. <code>common.js</code> is really for any code that&#8217;s going to be used over and over on your site. We&#8217;ll toss the <code>BasicModel</code> into <code>common.js</code> during the build process.</p>

<h2>Just hit build already&#8230;</h2>

<p>O.K., O.K. I can tell you&#8217;re ready to see some fireworks. Before we hit build, I want to point out the <code>options.js</code> file. This is where we tell <code>r.js</code> which modules to compile and what each module should include or exclude.</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">appDir</span><span class="o">:</span> <span class="s1">&#39;www&#39;</span><span class="p">,</span>
  <span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;js/&#39;</span><span class="p">,</span>
  <span class="nx">mainConfigFile</span><span class="o">:</span> <span class="s1">&#39;www/js/common.js&#39;</span><span class="p">,</span>
  <span class="nx">dir</span><span class="o">:</span> <span class="s1">&#39;www-release&#39;</span><span class="p">,</span>
  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;common&#39;</span><span class="p">,</span>
      <span class="nx">include</span><span class="o">:</span> <span class="p">[</span>
        <span class="s1">&#39;app/models/basicModel&#39;</span><span class="p">,</span>
        <span class="s1">&#39;jquery&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bootstrap&#39;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;app/main-about&#39;</span><span class="p">,</span>
      <span class="nx">exclude</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;app/main-contact&#39;</span><span class="p">,</span>
      <span class="nx">exclude</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>
</code></pre></figure>


<p>You&#8217;ll note that first we put together our common module, then we tell the subsequent modules to exclude it. When you tell <code>r.js</code> to exclude a module it will find all of the nested dependencies in that module and exclude those as well. This is why we don&#8217;t need to tell <code>main-about</code> and <code>main-contact</code> to exclude <code>bootstrap</code>. It sees that <code>bootstrap</code> is already in <code>common</code>, so it knows to exclude it.</p>

<p>If you haven&#8217;t done so already, now is a good time to do an <code>npm install</code>. That should pull down all of the <code>grunt</code> dependencies. Speaking of <code>grunt</code>, you&#8217;ll need to install that as well if you&#8217;ve never used it <code>npm install -g grunt-cli</code>. You might notice in our <code>Gruntfile.js</code>, we are using a number of tasks from the <a href="https://github.com/gruntjs/grunt-contrib">grunt-contrib</a> library. <code>grunt-contrib</code> is a great resource, and I encourage you to spend some time looking through all of the tasks that fall under its umbrella.</p>

<p>O.K. Ready to rock. Just type <code>grunt</code> to build, or <code>grunt.cmd</code> if you&#8217;re on Windows (thanks <a href="http://twitter.com/stevensacks">@stevensacks</a>). When you&#8217;re finished, you should have a new folder called <code>www-release</code>. Check out the <code>build.txt</code> file to see where everything ended up.</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code><span class="nx">css</span><span class="o">/</span><span class="nx">bootstrap</span><span class="o">-</span><span class="nx">responsive</span><span class="p">.</span><span class="nx">css</span>
<span class="o">----------------</span>
<span class="nx">css</span><span class="o">/</span><span class="nx">bootstrap</span><span class="o">-</span><span class="nx">responsive</span><span class="p">.</span><span class="nx">css</span>

<span class="nx">css</span><span class="o">/</span><span class="nx">bootstrap</span><span class="p">.</span><span class="nx">css</span>
<span class="o">----------------</span>
<span class="nx">css</span><span class="o">/</span><span class="nx">bootstrap</span><span class="p">.</span><span class="nx">css</span>

<span class="nx">css</span><span class="o">/</span><span class="nx">style</span><span class="p">.</span><span class="nx">css</span>
<span class="o">----------------</span>
<span class="nx">css</span><span class="o">/</span><span class="nx">style</span><span class="p">.</span><span class="nx">css</span>

<span class="nx">js</span><span class="o">/</span><span class="nx">common</span><span class="p">.</span><span class="nx">js</span>
<span class="o">----------------</span>
<span class="nx">js</span><span class="o">/</span><span class="nx">common</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">models</span><span class="o">/</span><span class="nx">basicModel</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">js</span><span class="o">/</span><span class="nx">vendor</span><span class="o">/</span><span class="nx">bootstrap</span><span class="p">.</span><span class="nx">js</span>

<span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">main</span><span class="o">-</span><span class="nx">about</span><span class="p">.</span><span class="nx">js</span>
<span class="o">----------------</span>
<span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">models</span><span class="o">/</span><span class="nx">aboutModel</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">main</span><span class="o">-</span><span class="nx">about</span><span class="p">.</span><span class="nx">js</span>

<span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">main</span><span class="o">-</span><span class="nx">contact</span><span class="p">.</span><span class="nx">js</span>
<span class="o">----------------</span>
<span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">models</span><span class="o">/</span><span class="nx">contactModel</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">main</span><span class="o">-</span><span class="nx">contact</span><span class="p">.</span><span class="nx">js</span>
</code></pre></figure>


<p>If you take a look at the <code>common.js</code> file in <code>www-release</code>, it should look like a big blob of minified code. That&#8217;s what we want to see. In this case it contains our <code>BasicModel</code>, Twitter Bootstrap, jQuery, and our original configuration code. If you refer to about.html you can see how we control the load order:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;./js/vendor/require.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
<span class="c1">// Load common code that includes config,</span>
<span class="c1">// then load the app logic for this page.</span>
<span class="nx">require</span><span class="p">([</span><span class="s1">&#39;./js/common&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">common</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ./js/common.js sets the baseUrl to be ./js/</span>
  <span class="c1">// You can ask for &#39;app/main-about&#39; here instead</span>
  <span class="c1">// of &#39;./js/app/main-about&#39;</span>
  <span class="nx">require</span><span class="p">([</span><span class="s1">&#39;app/main-about&#39;</span><span class="p">]);</span>
<span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></figure>


<p>First, we bring in RequireJS. Then we load <code>common.js</code>, and only <em>after</em> <code>common.js</code> is loaded do we request the page specific code in <code>main-about</code>. If you stick to this structure, you should be able to layer your code so it&#8217;s easy to manage.</p>

<h2><a href="https://github.com/robdodson/requirejs-multipage-shim-tutorial">Grab the Example Source</a></h2>

<p>Hope you learned something new today. Feedback and suggestions always welcome in the comments below. Thanks!</p>

<p>You should follow me on Twitter <a href="http://twitter.com/rob_dodson">here.</a></p>

	</section>
	<div class="newsletter">
  <form action="http://robdodson.us7.list-manage2.com/subscribe/post?u=5727aa0eb1ccbf4ae68284189&amp;id=6719a28b56" method="post" target="_blank" novalidate>
    <p class="newsletter-heading newsletter-primary">Get your learn on.</p>
    <p class="newsletter-heading newsletter-sub">
      Weekly emails cover Web Components, and the future of
      Front-end Development.
    </p>
    <input class="newsletter-email" type="email" value="" name="EMAIL" placeholder="your@email.com">
    <input type="hidden" name="group[4133][1]" value="true">
    <input class="newsletter-submit" type="submit" value="Subscribe" name="subscribe">
  </form>
</div>

  <footer class="post-footer">
  <section class="author">
    <h4>Rob Dodson</h4>
    <p></p>
  </section>
  <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?text=A Require.js multi-page shimmed site: How-To&amp;url=http://robdodson.github.com/blog/2012/11/18/a-require-dot-js-multipage-shimmed-site-how-to/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://robdodson.github.com/blog/2012/11/18/a-require-dot-js-multipage-shimmed-site-how-to/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://robdodson.github.com/blog/2012/11/18/a-require-dot-js-multipage-shimmed-site-how-to/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
    </a>
  </section>
</footer>
  <hr>
  
    <div class="share">
</div>

  
  
  <section id="comment">
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>
  
</article></main>
  <footer class="site-footer"><a class="subscribe icon-feed" href="http://robdodson.github.com/atom.xml"><span class="tooltip">Subscribe!</span></a>
<div class="inner">
  Follow me on <a href="http://twitter.com/rob_dodson" rel="me">Twitter</a>, <a rel="author" href="https://plus.google.com/118271135596408598424">Google+</a> or <a rel="me" href="http://github.com/robdodson">Github</a>
  <section class="copyright">All content copyright <a href="/">Rob Dodson</a> © 2013 • All rights reserved.</section>
  <section class="poweredby">Casper theme by <a class="icon-ghost" href="http://tryghost.org">Ghost</a> &amp; Published with <a href="http://octopress.org">Octopress</a></section>
</div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="//yandex.st/highlightjs/7.3/highlight.min.js"></script>  
<script>hljs.initHighlightingOnLoad()</script>


<script type="text/javascript">
      var disqus_shortname = 'robdodsontalksinternets';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://robdodson.github.com/blog/2012/11/18/a-require-dot-js-multipage-shimmed-site-how-to/';
        var disqus_url = 'http://robdodson.github.com/blog/2012/11/18/a-require-dot-js-multipage-shimmed-site-how-to/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-25869920-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</body>
</html>
